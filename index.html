<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slideshow Generator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <style>
        .slideshow {
            width: 512px;
            height: 512px;
            border: 1px solid black;
        }

        .slideshow img {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Slideshow Generator</h1>
        <button id="start-btn" class="btn btn-primary">Start</button>
        <button id="stop-btn" class="btn btn-primary">Stop</button>
        <div class="slideshow my-5">
            <img src="#">
        </div>
        <div class="log my-5">

        </div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <script>
        var api_key = "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX";
        var counter = 0;
        var interval = null;

        function setImage(image) {
            $(".slideshow img").fadeOut(500, function() {
                $(".slideshow img").attr("src", "data:image/png;base64, " + image);
                $(".slideshow img").fadeIn(500);
            });
        }

        function log(prompt, image) {
            $(".log").append("<p><b>Prompt: </b>" + prompt + "</p>");
            $(".log").append('<button class="btn btn-primary" id="btn-expand-image'+counter+'">Expand Image</button>');
            $(".log").append('<div id="image'+counter+'" style="display: none;"><img src="data:image/png;base64, ' + image + '"></div>');
            $("#btn-expand-image"+counter).click(function() {
                $("#image"+counter).toggle();
            });
        }

        function logPromptError(prompt) {
            $(".log").append("<p><b>Prompt: </b>" + prompt + "</p>");
            $(".log").append("<p><b>Error: </b>There was an error generating the image.</p>");
        }

        function logChatError() {
            $(".log").append("<p><b>Error: </b>There was an error generating the prompt.</p>");
        }

        function randomChoice(arr) {
            return arr[Math.floor(arr.length * Math.random())];
        }

        function getPrompt() {
            var initial_prompts = [
                "Tell me a random animal",
                "Tell me a random tourist atraction",
                "Tell me a random food",
                "Tell me a random place",
                "Tell me a random object",
                "Tell me a random famous person",
                "Tell me a random building",
                "Tell me a random natural wonder",
                "Tell me a random vehicle and specify the brand and model",
                "Tell me a random product and specify the brand and model",
                "Describe a city in the future in two sentences",
                "Describe a city in the 18th century in two sentences",
                "Describe a person in the 18th century in two sentences",
                "Describe a person in the future in two sentences",
                "Describe a city in a fantasy world in two sentences",
                "Describe an abstract concept in two sentences",
                "Describe a creature in a fantasy world in two sentences",
                "Describe the interior design of a random room in two sentences",
                "Describe the interior of a coffeeshop in two sentences",
                "Describe the interior of a restaurant in two sentences",
                "Describe the interior of a factory in two sentences"
            ];

            var initial_prompt = randomChoice(initial_prompts);
            getAnswer(initial_prompt);
        }

        function getImage(prompt) {
            var data = {
                "prompt": prompt,
                "n": 1,
                "size": "512x512",
                "response_format": "b64_json"
            }

            $.ajax({
                url: "https://api.openai.com/v1/images/generations",
                method: "POST",
                dataType: "json",
                crossDomain: true,
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(data),
                cache: false,
                timeout: 30000,
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("Authorization", "Bearer " + api_key);
                },
                success: function (data) {
                    console.log(data);
                    var image = data.data[0].b64_json;
                    setImage(image);
                    log(prompt, image);
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    logPromptError(prompt);
                }
            });
        }

        function getAnswer(text) {
            var data = {
            "model": "gpt-3.5-turbo",
            "messages": [{"role": "user", "content": text}]
            }

            $.ajax({
            url: "https://api.openai.com/v1/chat/completions",
            method: "POST",
            dataType: "json",
            crossDomain: true,
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(data),
            cache: false,
            beforeSend: function (xhr) {
                xhr.setRequestHeader("Authorization", "Bearer " + api_key);
            },
            success: function (data) {
                var message = data.choices[0].message.content
                getImage(message);
            },
            error: function (jqXHR, textStatus, errorThrown) {
                alert("There was an error sending the request to the API.");
            }
            });
        }

        $("#start-btn").click(function() {
            getPrompt();
            interval = setInterval(function() {
                getPrompt();
            }, 30000);
        });

        $("#stop-btn").click(function() {
            clearInterval(interval);
        });
    </script>
</body>
</html>